<project name="myprojects" default="jar" basedir=".">
<property name="out" location="${basedir}/out"/>
<property name="dist" location="${basedir}/dist"/>
<property name="src" location="${basedir}/src"/>
<property name="test" location="${basedir}/test"/>
<property name="lib" location="${basedir}/lib"/>
<property name="reports" location="${basedir}/reports"/>
<property name="version" value="1.0"/>
<path id="classpath">
    <fileset dir="${lib}" includes="**/*.jar"/>
    <pathelement path="resources"/>
</path>
<path id="classpath-test">

    <fileset dir="${lib}" includes="**/*.jar"/>
    <fileset dir="${basedir}/src/com/nixsolutions/service" includes="*.jar" />
    <pathelement location="${basedir}/src/com/nixsolutions/service/dao"/>
    <pathelement path="resources"/>
    <pathelement path="${out}/test/myprojects/resources"/>
    <pathelement path="${src}/com/nixsolutions/service/dao"/>
    <pathelement path="${out}out/test/myprojects/com/nixsolutions/service/jdbc"/>
</path>

<target name="init" depends="clean">
    <mkdir dir="${out}/production/myprojects"/>
    <mkdir dir="${out}/production/myprojects/resources"/>
    <mkdir dir="${out}/test/myprojects/com/nixsolutions/service/jdbc/"/>
    <mkdir dir="${out}/test/myprojects/resources"/>
    <mkdir dir="${dist}"/>
    <mkdir dir="${reports}/testreport"/>
</target>

<target name ="copy-resources" depends="init">
    <copy todir="${out}/production/myprojects/resources">
        <fileset dir="${basedir}/src/resources"/>
    </copy>
</target>

<target name="copy-test-resources" depends="copy-resources">
    <copy todir="${out}/test/myprojects/resources">
        <fileset dir="${basedir}/test/resources"/>
    </copy>
</target>

<target name="testcompile1" depends="compile" description="compile the tests">
    <javac srcdir="${test}" destdir="${out}/test/myprojects" includeantruntime="true">
        <classpath refid="classpath-test"/>
    </javac>
</target>
    <target name="testcompile" depends="compile" description="compile the tests">
        <javac srcdir="${basedir}/test/" destdir="${out}/test/myprojects" includeantruntime="true">
            <classpath refid="classpath-test"/>
        </javac>
    </target>


    <target name="compile" depends="copy-test-resources">
        <javac srcdir="${src}" destdir="${out}/production/myprojects" includeantruntime="true" debug="true">
            <classpath refid="classpath"/>
        </javac>
    </target>

<target name="test" depends="testcompile1" description="run all tests">
    <junit fork="true" forkmode="once" failureProperty="test.failed" >
        <classpath refid="classpath-test"/>

        <classpath>
            <pathelement path="${out}/test/java"/>
        </classpath>

        <formatter type="xml"/>

        <batchtest todir="${reports}" fork="yes">
            <fileset dir="${test}" >
                <include name="**/*.java"/>
            </fileset>
        </batchtest>
    </junit>
</target>

<target name="testreport" depends="test">
    <junitreport todir="${reports}/testreport">
        <fileset dir="${reports}"/>
        <report todir="${reports}/testreport"/>
    </junitreport>
</target>

<target name="jar" depends="testreport">
    <jar destfile="${dist}/nje2jdbc.jar"
         basedir="${out}"
         includes="${out}/main">
    </jar>
</target>

<target name="clean">
    <delete dir="out/"/>
    <delete dir="dist"/>
    <delete dir="reports"/>
</target>

</project>
